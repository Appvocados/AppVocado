<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AppVocado</title>
    <meta name="autor" content="Salvador Angel">
    <meta name="copyrigth" content="Appvocado.org">
    <link rel="icon" type="image/gif" href="img/avocado-1-icon.gif">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="header.js"></script>
    <script src="footer.js"></script>
    <script src="scriptsForSounds.js"></script>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="styleForComun.css">
    <link rel="stylesheet" href="cssForNewsSection.css">
    <link rel="stylesheet" href="styleForContratoModal.css">

</head>
<body>
    <!-- Header -->
    <header>
        <!-- Llama a la función mostrarHeader() para mostrar el header -->
        <script>
            mostrarHeader();
        </script>
    </header>

    <!-- Título -->
    <h1 id="tituloPrecio">Precio actual del Aguacate de Exportación calibre 210g por Kg. 
      <p id="ultimoPrecioExportacion" class="precio-destacado"></p> <!-- Agrega este span donde quieras mostrar el último precio -->
    </h1> 

    <!-- Prices Container -->
    <div id="Prices">
        
        <!-- Grafic Container -->
        <!-- Elemento HTML para el gráfico de Datos Exportacion -->
    <div id="Grafic">
      <canvas id="myChartExportacion" class="grafico" width="400" height="auto"></canvas>
  
      <!-- Elemento HTML para el gráfico de Datos Nacional 
      <h2>Precio del aguacate Nacional por Kg. (en $)</h2>
      <canvas id="myChartNacional" class="grafico" width="400" height="200"></canvas> -->
      </div> 

        <div id="precioDiv" class="box">
          <p id="mensajePrecio"> Vende tu producción a precio de exporatación <span id="otraSeccionUltimoPrecio"></span>
            por Kg. 
            
          </p>
  
          <div id="venderContainer">
            <button class="button blink" id="venderButton">Vender</button>
        </div>
    
        <!-- Formulario oculto inicialmente -->
        <form id="dataForm" style="display: none;">
            <label for="name">Nombre:</label>
            <input type="text" id="name" name="name" required>
            
            <label for="phoneNumber">Número de Teléfono:</label>
            <input type="text" id="phoneNumber" name="phoneNumber" required>

            <label for="huertaName">Nombre de la Huerta</label>
            <input type="text" id="huertaName" name="huertaName" required>
            
            <button class="button" type="submit" onclick="mostrarContrato()">Enviar</button>
        </form>

        <!-- Modal -->
<div class="modal" id="contratoModal">
  <div class="modal-content">
      <!-- Contenido del contrato -->
      <span class="close" onclick="cerrarContrato()">&times;</span>
      <div id="contenidoContrato"></div>
      <button id="aceptarBtn"  onclick="aceptarContrato()">Aceptar</button>
      <button id="descargarBtn" onclick="descargarContrato()">Descargar Contrato en PDF</button>
  </div>
</div>
    
        <!-- Mensaje de venta oculto inicialmente -->
        <div id="mensajeVenta" Class="green" style="display: none;">
            Has vendido tu producción de aguacate, pronto te contactaremos.
        </div>
      </div>
    </div>

    <!-- News Sección -->
    <div class="content-container">
      <section id="newsSection">
        <h2>"AppVocado: Tu Aliado en el Éxito de la Venta de Aguacate
          Descubre por Qué AppVocado es la Elección de los Productores de Michoacán"</h2>
        <!-- Add your news content here -->
        <!-- You can use <article>, <div>, or other appropriate elements to structure your news items -->
          <p>AppVocado es una innovadora aplicación diseñada específicamente para los productores de aguacate en Michoacán y la región circundante, con el objetivo principal de proporcionar información de precios en tiempo real para que los productores puedan vender su aguacate a las empacadoras exportadoras de manera directa y eficiente. Esta herramienta se ha diseñado teniendo en cuenta las necesidades únicas de los agricultores de aguacate en esta importante zona productora.</p>
          <p><strong>Precios en Tiempo Real:</strong> AppVocado se basa en datos en tiempo real que provienen de una variedad de fuentes confiables y actualizadas constantemente. Esto permite a los productores de aguacate en Michoacán y la región estar al tanto de las fluctuaciones en los precios del aguacate de manera instantánea, lo que es crucial para tomar decisiones informadas al vender su producto a las empacadoras exportadoras.</p>
          <p><strong>Notificaciones Personalizadas:</strong> La aplicación ofrece la capacidad de configurar notificaciones personalizadas. Los usuarios pueden definir umbrales de precio específicos, y cuando el precio del aguacate alcance ese punto, recibirán notificaciones inmediatas, lo que les permite actuar rápidamente según las condiciones del mercado en Michoacán y áreas circundantes.</p>
          <ul>
              <li><strong>Histórico de Precios:</strong> AppVocado almacena registros históricos de precios, lo que permite a los productores de aguacate de Michoacán evaluar tendencias a lo largo del tiempo. Esta información es valiosa para la planificación a largo plazo y la estrategia de ventas en la región.</li>
              <li><strong>Análisis Comparativo:</strong> La aplicación proporciona herramientas de análisis que permiten a los productores comparar precios entre diferentes empacadoras exportadoras en Michoacán y sus alrededores. Esto ayuda a los productores a tomar decisiones más informadas sobre a qué empacadora vender su aguacate, maximizando sus operaciones en la zona.</li>
          </ul>
          <p><strong>Información Meteorológica:</strong> AppVocado no solo se limita a los precios; también integra datos meteorológicos relevantes para Michoacán y la región circundante. Los cambios climáticos pueden afectar la producción y la calidad del aguacate, por lo que esta información adicional es crucial para la toma de decisiones en la zona.</p>
          <p><strong>Interfaz Intuitiva:</strong> La aplicación está diseñada para ser fácil de usar, permitiendo a los productores de aguacate de Michoacán y áreas vecinas vender su producto con un solo click, lo que la convierte en la forma más fácil de realizar transacciones en la industria.</p>
          <p><strong>Seguridad y Privacidad:</strong> La seguridad de los datos y la privacidad de los usuarios son prioritarias. AppVocado garantiza la protección de la información confidencial de los productores en Michoacán.</p>
          <p><strong>Actualizaciones Constantes:</strong> El equipo detrás de AppVocado trabaja continuamente en la mejora de la aplicación, asegurando que esté siempre al día con las últimas tendencias y necesidades de la industria del aguacate en Michoacán y la región circundante.</p>
          <p><strong>Registro Simplificado de Hurtos:</strong> Además de proporcionar información de precios, AppVocado también informa a los productores sobre los pasos y procesos para registrar hurtos antes de sanidad vegetal de una forma rápida y eficiente, garantizando el cumplimiento de los requisitos y facilitando los procedimientos necesarios. Por esto, los productores lo prefieren.</p>
        </section>
    

        <!-- Banner for Advertising $$$ 
        <aside id="adBanner">Sección de publicidad
             Add your advertisement banner content here
             You can use an <img> tag to display the banner image or other elements as needed
        </aside> -->
    </div>

    <script type="module">
      // Importar las funciones necesarias de Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
      import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
  
     // Configuración de Firebase de tu aplicación web
     const firebaseConfig = {
        apiKey: "AIzaSyARHYNTJEWtSfdSMWQ30KRfcjGfb3OhjuU",
        authDomain: "appvocado-73e80.firebaseapp.com",
        databaseURL: "https://appvocado-73e80-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "appvocado-73e80",
        storageBucket: "appvocado-73e80.appspot.com",
        messagingSenderId: "1050213748494",
        appId: "1:1050213748494s:web:253da19a34a8b2cba9115f"
      };
      
      
      // Inicializar Firebase
      const app = initializeApp(firebaseConfig);
  
      // Obtener una referencia a la base de datos Realtime Database
      const db = getDatabase(app);
  
      // Obtener una referencia a cada colección de datos en Firebase
      const diariosRef = ref(db, '210g');
      /*const semanalesRef = ref(db, 'Nacional');
      const mensualesRef = ref(db, 'mensuales');
      const anualesRef = ref(db, 'anuales');
      const historicosRef = ref(db, 'historicos');*/

      function crearGrafico(data, canvasId, titulo) {
        if (!data) {
            console.error("Los datos son nulos o indefinidos.");
            return;
        }

        // Obtener solo el último elemento
        const ultimoPrecio = Object.values(data).pop()?.precio;

        // Mostrar el último precio en los spans respectivos
        document.getElementById('ultimoPrecioExportacion').textContent = `$${ultimoPrecio}`;
        document.getElementById('otraSeccionUltimoPrecio').textContent = `$${ultimoPrecio}`;

        // Obtener solo los últimos 4 elementos para el gráfico
        const labels = Object.keys(data).slice(-4);
        const valores = Object.values(data).slice(-4).map(entry => entry.precio);

        const ctx = document.getElementById(canvasId).getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: '$',
                    data: valores,
                    borderColor: "chartreuse",
                    color: "#fff",
                    backgroundColor: "rgba(26, 199, 60, 0.2)",
                    fill: true,
                    borderWidth: 4,
                    tension: 0.4,
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: titulo
                    }
                }
            }
        });
    }

      function obtenerYCrearGrafico(ref, canvasId, titulo) {
          onValue(ref, (snapshot) => {
              const data = snapshot.val();
              crearGrafico(data, canvasId, titulo);
          });
      }

      obtenerYCrearGrafico(diariosRef, 'myChartExportacion', 'Calibre 210g');
       /*obtenerYCrearGrafico(semanalesRef, 'myChartNacional', 'Precio del aguacate Nacional por Kg. (en $)');
      obtenerYCrearGrafico(mensualesRef, 'myChartMensual', 'Datos Mensuales');
      obtenerYCrearGrafico(anualesRef, 'myChartAnual', 'Datos Anuales');
      obtenerYCrearGrafico(historicosRef, 'myChartHistorico', 'Datos Históricos');*/
  </script>
    
    
    <script type="module">
      // Importar las funciones necesarias de Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
      import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
  
       // Configuración de Firebase de tu aplicación web
       const firebaseConfig = {
            apiKey: "AIzaSyARHYNTJEWtSfdSMWQ30KRfcjGfb3OhjuU",
            authDomain: "appvocado-73e80.firebaseapp.com",
            databaseURL: "https://appvocado-73e80-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "appvocado-73e80",
            storageBucket: "appvocado-73e80.appspot.com",
            messagingSenderId: "1050213748494",
            appId: "1:1050213748494:web:253da19a34a8b2cba9115f"
          };
  
     // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  
  // Obtener una referencia a la base de datos Realtime Database
  const db = getDatabase(app);
   
  // Crear una referencia a la colección "Clientes"
  const clientsRef = ref(db, 'Clientes');
    
  // Obtener una referencia al formulario y los campos de entrada
  const form = document.getElementById('dataForm');
  const nameInput = document.getElementById('name');
  const phoneNumberInput = document.getElementById('phoneNumber');
  
  // Agregar un evento de escucha al formulario para capturar los valores ingresados y guardarlos
  form.addEventListener('submit', (e) => {
    e.preventDefault();
  
    // Obtener el nombre y el número de teléfono ingresados
    const name = nameInput.value;
    const phoneNumber = phoneNumberInput.value;
  
    // Verificar que el nombre no esté vacío antes de guardar los datos
    if (name.trim() === '') {
      alert('Por favor, ingresa un nombre válido.');
      return;
    }
  
    // Obtener la fecha actual y formatearla en un formato específico
    const currentDate = new Date();
    const formattedDate = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')} ${currentDate.getHours().toString().padStart(2, '0')}:${currentDate.getMinutes().toString().padStart(2, '0')}:${currentDate.getSeconds().toString().padStart(2, '0')}`;
  
    // Obtener una referencia única para cada registro usando el nombre como clave
    const newDataRef = ref(db, `Clientes/${name}`);
  
    // Establecer el nombre, el número de teléfono y la fecha formateada en la base de datos
    set(newDataRef, {
      name: name,
      phoneNumber: phoneNumber,
      timestamp: formattedDate
    })
      .then(() => {
        console.log('Datos guardados con éxito.');
      })
      .catch((error) => {
        console.error('Error al guardar los datos: ', error);
      });
  
    // Limpiar los campos de entrada después de enviar
    nameInput.value = '';
    phoneNumberInput.value = '';
  });
    </script>

    <footer>
        <div id="footer-container"></div>
    </footer>
    <script src="scriptsForForm.js"></script>
    <!-- Script para manejar la apertura y cierre del modal -->
<script src="https://rawgit.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>
<script src="scripsForContratoModal.js"></script>

</body>
</html>
